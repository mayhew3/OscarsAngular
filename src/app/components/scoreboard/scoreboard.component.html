
<div class="scoreboard-body">
  <div class="container">

    <div class="row no-gutters">
      <div class="col-9">
        <h1>Live Scoring</h1>
      </div>

      <!-- ODDS FILTER BUTTON -->

      <div class="col-3 text-right">
        <div ngbDropdown placement="bottom-right"
             class="d-inline-block"
             *ngIf="!!me">
          <button class="btn btn-small btn-primary"
                  [disabled]="updatingOddsFilter"
                  id="oddsFilterDropdown"
                  ngbDropdownToggle>
            <i class="fas fa-filter"></i>
          </button>
          <div ngbDropdownMenu aria-labelledby="oddsFilterDropdown">
            <button *ngFor="let oddsOption of getOddsOptions()"
                    (click)="changeOddsOption(oddsOption)"
                    [ngClass]="getOddsFilterClass(oddsOption)"
                    ngbDropdownItem>
              {{getDisplayValueOf(oddsOption)}}
            </button>
          </div>
        </div>
      </div>
    </div>

    <p *ngIf="(odds$ | async) && getVoters().length === 0">
      No players have voted yet!
    </p>

    <!-- PLAYER SCORES -->

    <div class="row mt-2" *ngIf="(odds$ | async) as odds; else loading">
      <div class="col-12"
           *ngFor="let scoreData of getVoters()">
        <div class="card scoreCard fakeLink"
             [ngClass]="scorecardClass(scoreData)"
             [routerLink]="['/person', scoreData.person.id]">
          <div class="card-body py-0 px-3">
            <div class="row no-gutters mainRow">
              <div class="col-5">
                <span>{{getPersonName(scoreData.person) | async}}</span>
              </div>
              <div class="col-4">

                <div *ngIf="shouldShowOdds() | async" class="d-flex flex-row">
                  <span class="odds oddsSubtitle v-100 align-middle">Odds</span>

                  <div *ngIf="(oddsOutOfDate$ | async) === false"
                       class="d-flex flex-row">

                    <span class="odds oddsValue"
                          [ngStyle]="{ color: getOddsStyle(scoreData)}">
                      {{getOddsForPerson(scoreData)}}
                    </span>

                    <span *ngIf="showOddsChange(scoreData)"
                          class="oddsDiff"
                          [ngClass]="oddsDirectionClass(scoreData)">
                      {{oddsDirectionFormatted(scoreData)}}
                    </span>

                  </div>

                  <mat-spinner *ngIf="(oddsOutOfDate$ | async) === true"
                               class="ml-2"
                               [diameter]="18"
                               [color]="loadingColor"></mat-spinner>

                </div>

                <div *ngIf="(itsOver() | async)"
                     class="text-center oddsValue">
                  <div *ngIf="anyoneIsHigherInRankings(scoreData)">
                    {{getRank(scoreData)}}
                  </div>

                  <div *ngIf="!anyoneIsHigherInRankings(scoreData)"
                       class="text-center oddsValue goldOdds">
                    WINNER!
                  </div>
                </div>

              </div>
              <div class="col-3" style="justify-items: right">
                <div class="row no-gutters">
                  <div class="col-12 px-0 scorePoints">
                    <span *ngIf="gotPointsForLastWinner(scoreData.person) | async"
                          class="scorePositive">
                      <i class="fas fa-angle-double-up"></i>
                    </span>
                    <span class="scoreText"
                      [ngClass]="scoreNumberClass(scoreData)">{{scoreData.score}}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- LAST WINNER FOOTER BAR -->

<nav class="navbar navbar-expand navbar-dark fixed-bottom justify-content-center hopper winnerFooter"
    *ngIf="(odds$ | async)">

  <div class="container py-2">
    <div class="row flex-fill">

      <div *ngIf="!latestCategory && (itsOver() | async) === false"
           routerLink="/winners"
           class="fakeLink">
        <div class="col-12 py-1">
          <span class="footerSmall">Waiting for the first award to be presented!</span>
        </div>
      </div>

      <div *ngIf="(itsOver() | async)"
           class="col-12 flex-fill">
        <div class="row py-1">
          <div class="col-12 py-1">
            <span class="footerSmall">It's over!! Congrats,</span>
          </div>

          <div class="col-12 py-1"
               *ngFor="let winnerName of getWinnerFullNames()">
            <span class="footerBig">{{winnerName}}!!</span>
          </div>
        </div>
      </div>

      <div *ngIf="!!latestCategory"
           class="col-12 flex-fill fakeLink"
           routerLink="/winners">

        <div class="row py-1">
          <div class="col-12">
            <span class="footerInfo">{{getLastTimeAgo()}}</span>
          </div>

          <div class="col-12 py-1">
            <div class="row no-gutters">
              <div class="col-10">
                <div class="row">
                  <div class="col-12 py-1">
                    <span class="footerTitle">{{latestCategory.name}}</span>
                    <span class="footerTieNotification"
                          *ngIf="!!latestCategory.winners && latestCategory.winners.length > 1"> (Tie!)</span>
                  </div>
                </div>
                <div class="row my-2"
                     *ngFor="let winner of latestCategory.winners">
                  <div class="col-12">
                    <span class="footerBig">{{getWinnerName(winner) | async}}</span>
                  </div>
                  <div class="col-12"
                       *ngIf="!!(getWinnerSubtitle(winner) | async)">
                    <span class="footerSmall">{{getWinnerSubtitle(winner) | async}}</span>
                  </div>
                </div>
              </div>
              <div class="col-2 footerScore"
                   [ngClass]="getMyLastWinnerScoreClass()">
                {{latestCategory.points}}
              </div>
            </div>
          </div>

          <div class="col-12 text-right"
               *ngIf="(itsOver() | async) === false">
            {{getWinnerCategoryCount() | async}}/{{getTotalCategoryCount() | async}}
          </div>
          <div class="col-12"
               *ngIf="(itsOver() | async) === false">
            <ngb-progressbar type="info" [value]="getWinnerCategoryCount() | async" [max]="getTotalCategoryCount() | async"></ngb-progressbar>
          </div>

        </div>

      </div>
    </div>
  </div>
</nav>


<ng-template #loading>Loading...</ng-template>
